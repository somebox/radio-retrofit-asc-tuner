external_components:
  - source:
      type: local
      path: ../components

esphome:
  name: retro-radio
  friendly_name: Retro Radio
  libraries:
    - "SPI"
    - "Adafruit BusIO"

esp32:
  board: esp32dev
  framework:
    type: arduino
    platform_version: 6.9.0

logger:
  level: DEBUG

api:

ota:
  - platform: esphome

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  ap:
    ssid: "Retro Radio Fallback"

# I2C bus configuration
i2c:
  sda: GPIO21
  scl: GPIO22
  scan: true
  frequency: 400kHz

# Radio controller component - manages all hardware
radio_controller:
  id: radio
  # Preset button triggers for HA automations
  on_preset:
    - preset_num: 0
      then:
        - homeassistant.service:
            service: script.play_radio_preset_1
    - preset_num: 1
      then:
        - homeassistant.service:
            service: script.play_radio_preset_2
    - preset_num: 2
      then:
        - homeassistant.service:
            service: script.play_radio_preset_3
    - preset_num: 3
      then:
        - homeassistant.service:
            service: script.play_radio_preset_4
    - preset_num: 4
      then:
        - homeassistant.service:
            service: script.play_radio_preset_5
    - preset_num: 5
      then:
        - homeassistant.service:
            service: script.play_radio_preset_6
    - preset_num: 6
      then:
        - homeassistant.service:
            service: script.play_radio_preset_7

# Display mode selection
select:
  - platform: template
    name: "Display Mode"
    id: display_mode
    options: 
      - "radio"
      - "clock"
      - "animation"
    initial_option: "radio"
    optimistic: false
    set_action:
      - lambda: id(radio).set_mode(x);

# Brightness control (synchronized with potentiometer)
number:
  - platform: template
    name: "Display Brightness"
    id: display_brightness
    min_value: 0
    max_value: 255
    step: 1
    initial_value: 128
    optimistic: false
    set_action:
      - lambda: id(radio).set_brightness((int)x);

# Metadata display (track info, etc.)
text_sensor:
  - platform: template
    name: "Display Text"
    id: display_text
    icon: "mdi:music-note"
